<!DOCTYPE html>
<html lang="en">
<head>
  <!-- =========================================================
       SECTION 1: DOCUMENT HEAD
       ========================================================= -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Item Weight & Shipping Lookup</title>

  <!-- =========================================================
       SECTION 2: PAGE STYLES
       ========================================================= -->
  <style>
    body {
      font-family: Arial, Helvetica, sans-serif;
      background: #fff;
      color: #111;
      margin: 0;
      padding: 24px;
    }
    .container {
      max-width: 1100px;
      margin: 0 auto;
    }
    h1 {
      color: #000;
      margin-bottom: 4px;
    }
    .sub {
      color: #555;
      margin: 0 0 18px;
      font-size: 14px;
    }
    .search-bar {
      display: grid;
      grid-template-columns: 1fr 1fr 120px;
      gap: 10px;
      margin-bottom: 10px;
    }
    input,
    button,
    select {
      padding: 10px;
      border-radius: 8px;
      font-size: 15px;
      box-sizing: border-box;
    }
    input {
      border: 1px solid #ccc;
    }
    input:focus {
      border-color: #c40000;
      outline: none;
      box-shadow: 0 0 0 2px rgba(196, 0, 0, 0.15);
    }
    button {
      background: #c40000;
      color: #fff;
      border: 1px solid #c40000;
      cursor: pointer;
      font-weight: 600;
    }
    button:hover {
      filter: brightness(0.93);
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }
    th,
    td {
      border: 1px solid #ddd;
      padding: 8px;
      text-align: left;
      font-size: 13px;
    }
    th {
      background: #f4f4f4;
      cursor: pointer;
      user-select: none;
      position: relative;
    }
    tr:hover td {
      background: #f9f9f9;
    }
    .muted {
      color: #555;
      font-size: 13px;
      margin-top: 4px;
    }
    .badge {
      display: inline-block;
      padding: 1px 6px;
      border-radius: 999px;
      border: 1px solid #ddd;
      font-size: 11px;
      background: #fafafa;
    }
    #tableWrap {
      display: none;
    }
    .pagination {
      margin-top: 12px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 10px;
    }
    .pagination button {
      font-size: 14px;
    }
    .page-info {
      font-size: 14px;
      font-weight: bold;
    }
    .sort-icon {
      font-size: 12px;
      margin-left: 6px;
      color: #aaa;
    }
    th.active {
      background-color: #c40000;
      color: #fff;
    }
    th.active .sort-icon {
      color: #fff;
    }
    @media (max-width: 760px) {
      .search-bar {
        grid-template-columns: 1fr;
      }
      th,
      td {
        font-size: 12px;
      }
    }
  </style>
</head>
<body>
  <!-- =========================================================
       SECTION 3: PAGE HEADER
       ========================================================= -->
  <div class="container">
    <h1>Item Weight & Shipping Lookup</h1>
    <p class="sub">
      Search by <strong>Item # (exact)</strong> or <strong>Description keywords</strong>.<br>
      Results include vendor, weight (3 decimals), and shipping/handling levels.
    </p>

    <!-- =========================================================
         SECTION 4: SEARCH BAR
         ========================================================= -->
    <div class="search-bar">
      <input type="text" id="itemInput" placeholder="Item # (exact)">
      <input type="text" id="descInput" placeholder="Description keywords">
      <button id="clearBtn">Clear</button>
    </div>

    <!-- =========================================================
         SECTION 5: STATUS MESSAGE
         ========================================================= -->
    <div id="status" class="muted">
      Type an Item # (exact) or at least 2 characters in Description.
    </div>

    <!-- =========================================================
         SECTION 6: TABLE WRAPPER
         ========================================================= -->
    <div id="tableWrap">
      <!-- =======================================================
           SECTION 7: PAGINATION (TOP)
           ======================================================= -->
      <div class="pagination">
        <div class="page-info" id="pageTop"></div>
        <select id="pageJump"></select>
      </div>

      <!-- =======================================================
           SECTION 8: RESULTS TABLE
           ======================================================= -->
      <table id="resultTable">
        <thead>
          <tr>
            <th data-k="vendor">
              Vendor <span class="sort-icon">⬍</span>
            </th>
            <th data-k="style_num">
              Style # <span class="sort-icon">⬍</span>
            </th>
            <th data-k="product_title">
              Title <span class="sort-icon">⬍</span>
            </th>
            <th data-k="size">
              Size <span class="sort-icon">⬍</span>
            </th>
            <th data-k="piece_weight">
              Weight (lb) <span class="sort-icon">⬍</span>
            </th>
            <th data-k="ship_level">
              Ship Level <span class="sort-icon">⬍</span>
            </th>
            <th>Shipping $ min</th>
            <th>Shipping $/Item</th>
            <th>Handling $ min</th>
            <th>Handling $/Item</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>

      <!-- =======================================================
           SECTION 9: PAGINATION (BOTTOM)
           ======================================================= -->
      <div class="pagination">
        <button id="prevBtn">Previous</button>
        <div class="page-info" id="pageBottom"></div>
        <button id="nextBtn">Next</button>
      </div>
    </div>
  </div>

  <!-- =========================================================
       SECTION 10: END OF PAGE HTML
       ========================================================= -->

  <!-- =========================================================
       SECTION 11: SCRIPT START
       ========================================================= -->
  <script>
    // =========================================================
    // SECTION 12: CONFIG CONSTANTS
    // =========================================================
    const SUPABASE_URL = "https://sbfslzwnkztmodnlsigq.supabase.co";
    const SUPABASE_ANON = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNiZnNsendua3p0bW9kbmxzaWdxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjI3OTQ5NTgsImV4cCI6MjA3ODM3MDk1OH0.ebZ1IvA5FQN7EhIcluJvw3OqMFU4Czkhin_ffTPx9vg";
    const API_ITEMS = `${SUPABASE_URL}/rest/v1/items_unified`;
    const API_LEVELS = `${SUPABASE_URL}/rest/v1/shipping_levels`;

    // Default sort: Style # ascending
    let sortKey = "style_num";
    let sortAsc = true;

    // Pagination: 50 items per page (configurable)
    let page = 0;
    const pageSize = 50;
    let totalPages = 0;

    // =========================================================
    // SECTION 13: GLOBAL STATE VARIABLES
    // =========================================================
    let shippingLevels = [];
    let shippingLevelsLoaded = false;
    let currentRows = [];

    // =========================================================
    // SECTION 14: PAGE INIT
    // =========================================================
    document.addEventListener("DOMContentLoaded", () => {
      // -------------------------------------------------------
      // SECTION 15: DOM ELEMENT REFERENCES
      // -------------------------------------------------------
      const itemInput = document.getElementById("itemInput");
      const descInput = document.getElementById("descInput");
      const clearBtn = document.getElementById("clearBtn");
      const tableWrap = document.getElementById("tableWrap");
      const tbody = document.querySelector("#resultTable tbody");
      const statusEl = document.getElementById("status");
      const prevBtn = document.getElementById("prevBtn");
      const nextBtn = document.getElementById("nextBtn");
      const pageTop = document.getElementById("pageTop");
      const pageBottom = document.getElementById("pageBottom");
      const pageJump = document.getElementById("pageJump");

      // -------------------------------------------------------
      // SECTION 16: INITIAL SORT HEADER STATE
      // -------------------------------------------------------
      function setInitialSortHeader() {
        const headers = document.querySelectorAll("th[data-k]");
        headers.forEach(header => {
          header.classList.remove("active");
          const icon = header.querySelector(".sort-icon");
          if (icon) icon.textContent = "⬍";
        });
        const initialHeader = document.querySelector(`th[data-k="${sortKey}"]`);
        if (initialHeader) {
          initialHeader.classList.add("active");
          const icon = initialHeader.querySelector(".sort-icon");
          if (icon) icon.textContent = sortAsc ? "▲" : "▼";
        }
      }
      setInitialSortHeader();

      // -------------------------------------------------------
      // SECTION 17: SORTING HEADER EVENTS
      // -------------------------------------------------------
      document.querySelectorAll("th[data-k]").forEach(th => {
        th.addEventListener("click", () => {
          const key = th.dataset.k;
          if (!key) return;

          if (sortKey === key) {
            sortAsc = !sortAsc;
          } else {
            sortKey = key;
            sortAsc = true;
          }

          document.querySelectorAll("th[data-k]").forEach(header => {
            header.classList.remove("active");
            const icon = header.querySelector(".sort-icon");
            if (icon) icon.textContent = "⬍";
          });

          th.classList.add("active");
          const icon = th.querySelector(".sort-icon");
          if (icon) icon.textContent = sortAsc ? "▲" : "▼";

          page = 0;
          render(currentRows);
        });
      });

      // -------------------------------------------------------
      // SECTION 18: LOAD SHIPPING LEVELS
      // -------------------------------------------------------
      async function loadShippingLevels() {
        try {
          const url = new URL(API_LEVELS);
          url.searchParams.set("select", "*");
          url.searchParams.set("order", "min_weight.asc");

          const res = await fetch(url.toString(), {
            headers: {
              apikey: SUP
